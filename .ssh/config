# https://infosec.mozilla.org/guidelines/openssh.html#key-generation
#
# RSA keys are favored over ECDSA keys when backward compatibility ''is required'',
# thus, newly generated keys are always either ED25519 or RSA (NOT ECDSA or DSA).
# $ ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa_mozilla_$(date +%Y-%m-%d) -C "Mozilla key for xyz"

# ED25519 keys are favored over RSA keys when backward compatibility ''is not required''.
# This is only compatible with OpenSSH 6.5+ and fixed-size (256 bytes).
# $ ssh-keygen -t ed25519 -f ~/.ssh/id_ed25519_mozilla_$(date +%Y-%m-%d) -C "Mozilla key for xyz"

Host *
  # --- Basic Security ---
  Protocol 2                         # Disable SSH v1 (deprecated, insecure)
  AddressFamily any                  # Use IPv4 (inet) only unless you need IPv6 (inet6)
  ServerAliveInterval 60             # Keep connections alive safely
  ServerAliveCountMax 3              # Drop if unresponsive (prevents hang)
  ConnectTimeout 10                  # Avoid long connection hangs

  # --- Key Handling & Agent ---
# IdentitiesOnly yes                 # Donâ€™t offer extra keys from ssh-agent
  ForwardAgent yes                   # Prevent credential forwarding
  ForwardX11 no                      # Disable X11 forwarding
  ForwardX11Trusted no
  ClearAllForwardings yes            # Reset local/tunnel forwards unless explicitly defined

  # --- Cryptography ---
  # https://infosec.mozilla.org/guidelines/openssh.html#modern
  HostKeyAlgorithms ssh-ed25519-cert-v01@openssh.com,ssh-rsa-cert-v01@openssh.com,ssh-ed25519,ssh-rsa,ecdsa-sha2-nistp521-cert-v01@openssh.com,ecdsa-sha2-nistp384-cert-v01@openssh.com,ecdsa-sha2-nistp256-cert-v01@openssh.com,ecdsa-sha2-nistp521,ecdsa-sha2-nistp384,ecdsa-sha2-nistp256
  KexAlgorithms curve25519-sha256@libssh.org,ecdh-sha2-nistp521,ecdh-sha2-nistp384,ecdh-sha2-nistp256,diffie-hellman-group-exchange-sha256
  MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-512,hmac-sha2-256,umac-128@openssh.com
  Ciphers chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr

  # --- Host Verification ---
  StrictHostKeyChecking ask          # Prompt before trusting new hosts
  VerifyHostKeyDNS yes               # Use DNSSEC if available (disabled
  UserKnownHostsFile ~/.ssh/known_hosts
  HashKnownHosts yes                 # Ensure KnownHosts are unreadable if leaked - it is otherwise easier to know which hosts your keys have access to.

  # --- Logging ---
  LogLevel VERBOSE                   # Record key fingerprint at connect time

  # --- Misc ---
  TCPKeepAlive no                    # Rely on ServerAlive instead
  Compression no                     # Avoid CRIME-style compression attacks unless needed
  ControlMaster auto                 # Reuse connections securely
  ControlPersist 5m
  ControlPath ~/.ssh/sockets/%r@%h:%p

Include ~/.ssh/config.d/*.conf
